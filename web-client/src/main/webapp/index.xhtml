<ui:composition template="template/layout.xhtml"
	xmlns="http://www.w3.org/1999/xhtml"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:fn="http://java.sun.com/jsp/jstl/functions"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:func="http://connection.sh.com/functions">
	
	<ui:param name="title" value="Welcome to Connection" />
	
	<ui:define name="content">
	   <div class="row">
	       <div class="span12">
				<f:view>
					<h:form id="usersForm">
						<h:dataTable value="#{usersBean.users}" var="user" styleClass="table table-bordered table-striped" rendered="#{not empty usersBean.users}">
							<f:facet name="header">
								<h:outputText value="Registered users:" />
							</f:facet>
		
							<h:column>
								<f:facet name="header">
									<h:outputText value="User" />
								</f:facet>
								<h:outputText value="#{user.name}" />
							</h:column>
		
							<h:column>
								<f:facet name="header">
									<h:outputText value="Actions" />
								</f:facet>
								<h:panelGroup rendered="#{user.visible or user.id == activeUserBean.user.id}">
									<h:panelGroup rendered="#{activeUserBean.loggedIn and (user.id != activeUserBean.user.id)}">
									    &#0160;
										<ui:param name="isSubscribe" value="#{func:contains(activeUserBean.userSubscriptions, user.id)}" />
										<h:commandLink action="#{activeUserBean.subscribe}" value="Subscribe" rendered="#{not isSubscribe}" styleClass="btn">
											<f:setPropertyActionListener target="#{activeUserBean.subscriptionId}" value="#{user.id}" />
										</h:commandLink>
										<h:commandLink action="#{activeUserBean.unsubscribe}" value="Unsubscribe" rendered="#{isSubscribe}" styleClass="btn">
											<f:setPropertyActionListener target="#{activeUserBean.subscriptionId}" value="#{user.id}" />
										</h:commandLink>
									</h:panelGroup>
								</h:panelGroup>
							</h:column>
							
						</h:dataTable>
					</h:form>
				</f:view>
	       </div>
		</div>
	</ui:define>
</ui:composition>
